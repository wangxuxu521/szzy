# 4 系统设计

## 4.1 体系结构设计

本系统采用前后端分离的 B/S 架构，前端使用 Vue.js 框架，后端使用 Spring Boot 框架，数据库使用 MySQL。系统整体架构如图 4-1 所示。

![系统架构图](系统架构图.png)

**前端技术栈**：

- Vue.js：前端 MVVM 框架
- Vite：构建工具
- Element Plus：UI 组件库
- Axios：HTTP 客户端
- Vue Router：路由管理

**后端技术栈**：

- Spring Boot：后端框架
- Spring Security：安全认证框架
- MyBatis：ORM 框架
- MySQL：关系型数据库
- Maven：项目管理工具

**系统分层**：

1. 表现层：用户界面，负责与用户交互
2. 控制层：处理请求，协调业务逻辑
3. 服务层：实现业务逻辑
4. 数据访问层：与数据库交互，实现数据的 CRUD 操作
5. 数据层：数据存储

## 4.2 系统详细设计

### 4.2.1 用户认证与权限管理模块

用户认证采用基于 JWT 的认证机制，实现无状态的用户认证。权限管理采用 RBAC 模型，根据用户角色分配不同权限。

**认证流程**：

1. 用户登录，提交用户名和密码
2. 服务端验证用户身份
3. 验证通过后，生成 JWT 令牌
4. 返回令牌给客户端
5. 客户端存储令牌，后续请求携带令牌
6. 服务端验证令牌有效性，确定用户身份和权限

### 4.2.2 资源管理模块

资源管理模块负责资源的上传、存储、检索和下载等功能。

**资源上传流程**：

1. 用户选择文件并填写资源信息
2. 前端检验文件类型和大小
3. 将文件和元数据发送到服务端
4. 服务端接收文件并存储到指定目录
5. 记录资源信息到数据库
6. 进入审核流程（如需）

**资源存储策略**：

- 物理存储：资源文件存储在服务器的指定目录
- 元数据存储：资源信息存储在数据库中
- 唯一标识：使用 UUID 为每个文件生成唯一标识符

### 4.2.3 资源审核模块

审核模块确保上传的资源符合系统规定和质量标准。

**审核流程**：

1. 资源上传后，状态设为"待审核"
2. 管理员收到审核通知
3. 管理员审核资源内容和描述
4. 作出审核决定（通过或拒绝）
5. 更新资源状态
6. 通知上传者审核结果

### 4.2.4 资源预览模块

预览模块提供在线查看资源内容的功能，支持多种文件格式。

**预览实现方式**：

- PDF 文档：使用 PDF.js 实现在线预览
- Office 文档：转换为 PDF 或使用 Office Online 实现预览
- 图片：直接在页面中显示
- 视频/音频：使用 HTML5 的 video/audio 标签实现在线播放

## 4.3 系统类图设计

系统主要包含以下核心类：

1. **用户类(User)**：表示系统用户，包含用户基本信息和认证信息
2. **资源类(Resource)**：表示教学资源，包含资源信息和文件路径
3. **评论类(Comment)**：表示用户对资源的评论
4. **评分类(Rating)**：表示用户对资源的评分
5. **收藏类(Favorite)**：表示用户对资源的收藏
6. **课程类(Course)**：表示教学课程，可以包含多个资源
7. **资源类型类(Type)**：表示资源的分类
8. **标签类(Tag)**：表示资源的标签
9. **公告类(Announcement)**：表示系统公告
10. **系统配置类(SystemConfig)**：表示系统配置信息

类之间的关系可表示为：

- 用户与资源：一对多（上传关系）
- 用户与评论：一对多
- 用户与评分：一对多
- 用户与收藏：一对多
- 资源与评论：一对多
- 资源与评分：一对多
- 资源与收藏：一对多
- 资源与标签：多对多
- 资源与类型：多对一

## 4.4 数据库详细设计

数据库设计采用关系型数据库 MySQL，主要包含以下表：

1. **用户表(user)**：存储用户信息

   - user_id（主键）：用户 ID
   - username：用户名
   - password：密码
   - name：真实姓名
   - email：电子邮箱
   - phone：联系电话
   - role：角色（admin/teacher/student）
   - status：状态
   - avatar：头像路径
   - last_login_time：最后登录时间
   - create_time：创建时间
   - update_time：更新时间

2. **资源表(resource)**：存储资源信息

   - resource_id（主键）：资源 ID
   - title：资源标题
   - description：资源描述
   - file_path：文件路径
   - format：文件格式
   - type_id：资源类型 ID（外键）
   - upload_time：上传时间
   - update_time：更新时间
   - download_count：下载次数
   - rating：评分
   - uploader_id：上传者 ID（外键）
   - review_status：审核状态
   - file_name：文件原始名称
   - file_size：文件大小
   - view_count：浏览次数
   - type：资源类型（教学资源/教学案例/研究成果）
   - tags：标签（JSON 格式）

3. **评论表(comment)**：存储评论信息

   - comment_id（主键）：评论 ID
   - resource_id：资源 ID（外键）
   - user_id：评论用户 ID（外键）
   - content：评论内容
   - parent_id：父评论 ID
   - create_time：创建时间
   - status：状态

4. **评分表(resource_rating)**：存储评分信息

   - id（主键）：评分 ID
   - resource_id：资源 ID（外键）
   - user_id：用户 ID（外键）
   - rating：评分值
   - create_time：创建时间
   - update_time：更新时间

5. **收藏表(resource_favorite)**：存储收藏信息

   - id（主键）：收藏 ID
   - user_id：用户 ID（外键）
   - resource_id：资源 ID（外键）
   - create_time：收藏时间

6. **课程表(course)**：存储课程信息

   - course_id（主键）：课程 ID
   - course_name：课程名称
   - description：课程描述
   - type_id：类型 ID（外键）
   - teacher_id：教师 ID（外键）
   - create_time：创建时间
   - status：状态
   - cover_image：封面图片

7. **资源类型表(type)**：存储资源类型

   - type_id（主键）：类型 ID
   - type_name：类型名称
   - description：类型描述
   - parent_id：父类型 ID
   - sort_order：排序顺序
   - create_time：创建时间
   - update_time：更新时间
   - status：状态

8. **标签表(tag)**：存储标签信息

   - tag_id（主键）：标签 ID
   - tag_name：标签名称
   - tag_type：标签类型
   - create_time：创建时间
   - update_time：更新时间

9. **资源标签关联表(resource_tag)**：存储资源与标签的对应关系

   - id（主键）：关联 ID
   - resource_id：资源 ID（外键）
   - tag_id：标签 ID（外键）
   - create_time：创建时间

10. **系统公告表(announcement)**：存储系统公告

    - id（主键）：公告 ID
    - title：公告标题
    - content：公告内容
    - type：公告类型
    - priority：优先级
    - publisher：发布者
    - publish_time：发布时间
    - create_time：创建时间
    - update_time：更新时间
    - status：状态

11. **系统配置表(system_config)**：存储系统配置

    - id（主键）：配置 ID
    - config_key：配置键
    - config_value：配置值
    - description：描述
    - create_time：创建时间
    - update_time：更新时间

12. **资源审核表(review)**：存储审核信息

    - review_id（主键）：审核 ID
    - resource_id：资源 ID（外键）
    - reviewer_id：审核人 ID（外键）
    - review_time：审核时间
    - review_opinion：审核意见
    - review_result：审核结果
    - create_time：创建时间

13. **用户操作记录表(user_action)**：存储用户操作记录
    - action_id（主键）：操作 ID
    - user_id：用户 ID（外键）
    - resource_id：资源 ID（外键）
    - action_type：操作类型
    - action_time：操作时间
    - comment_content：评论内容
    - ip_address：IP 地址
